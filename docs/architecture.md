# アーキテクチャ (Architecture)

本プロジェクト `sd-visual-prompt-editor` の全体像と、データの流れについて解説します。

## 1. システム全体図

本システムは、ビルド時（Python）と実行時（ブラウザ）の2つのフェーズで構成されています。

### データフローの概要

1.  **マスターデータ**: `danboru_tag.tsv` を入力として使用します。
2.  **ビルドプロセス**: `update_data.py` が TSV と `thresholds.json` を読み込み、処理を行います。
3.  **配信データ**: フロントエンドが読み込みやすい形式の `danboru_dictionary.json` が生成されます。
4.  **フロントエンド**: ブラウザ上で `index.html` が辞書データを読み込み、ユーザーにタグの提案を行います。

## 2. モジュール構成

### Python バックエンド (ビルドツール)

- **update_data.py**: データのフィルタリングと変換を担うメインスクリプトです。
- **export_db.py**: データベース（SQL Server等）との連携やデータ出力に使用されます。

### Web フロントエンド

- **index.html**: アプリケーションのメイン UI です。
- **styles.css**: CSS 変数を用いたモダンなスタイリングを管理します。
- **main.js (または script.js)**: 辞書データの検索、タグの選択、SD 用プロンプトの組み立てロジックを制御します。

## 3. データの流れ (詳細)

| ステップ     | 役割                                 | 入力ファイル              | 出力ファイル              |
| :----------- | :----------------------------------- | :------------------------ | :------------------------ |
| **タグ更新** | タグデータの正規化としきい値処理     | `danboru_tag.tsv`         | `danboru_dictionary.json` |
| **画面表示** | ユーザー入力に応じたタグの検索・提案 | `danboru_dictionary.json` | (ブラウザの DOM)          |
| **出力生成** | SD 用のプロンプト構文の組み立て      | 選択されたタグ            | (クリップボード/テキスト) |

## 4. DOM 構造の設計

メイン画面は、効率的なプロンプト編集を可能にするため、以下の主要エリアで構成されています。

- **入力エリア**: 検索ワードや現在のプロンプトを入力。
- **提案エリア**: 辞書データから動的に生成されたタグ候補を表示。
- **プレビューエリア**: 重み付け（括弧）などが適用された最終的なプロンプトを表示。
